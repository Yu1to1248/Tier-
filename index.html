<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TierMaker</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #1e1e1e;
      color: white;
    }
    header {
      text-align: center;
      padding: 30px 10px 10px;
      background: #111;
      border-bottom: 2px solid #333;
    }
    header h1 {
      font-size: 2.5em;
      font-weight: bold;
      letter-spacing: 2px;
      color: #ff4081;
      margin: 0;
    }
    header p {
      margin: 5px 0 15px;
      font-size: 0.9em;
      color: #ccc;
    }
    #controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
      background: #2a2a2a;
    }
    .tier {
      display: flex;
      align-items: center;
      padding: 0;
      border-bottom: 1px solid #111;
    }
    .tier-label {
      width: 100px;
      font-weight: bold;
      text-align: center;
      padding: 20px 10px;
      color: black;
    }
    .tier-content {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      min-height: 80px;
      padding: 10px;
      background: #000;
      align-items: center;
    }
    .image-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
    }
    .image-item {
      width: 60px;
      height: 60px;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid #555;
      border-radius: 6px;
      transition: transform 0.2s;
    }
    .image-item:hover {
      transform: scale(1.05);
      border-color: #ff4081;
    }
    .delete-btn {
      position: absolute;
      top: -8px;
      right: -8px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 12px;
      cursor: pointer;
      display: none;
    }
    .image-wrapper.active .delete-btn {
      display: block;
    }
    #scoring-panel {
      background: #333;
      padding: 10px;
      margin: 20px;
      border-radius: 8px;
    }
    .hidden {
      display: none;
    }
    #unclassified-wrapper {
      margin: 20px;
    }
    #unclassified {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
      background: #000;
      min-height: 80px;
      border: 2px dashed #888;
      border-radius: 6px;
    }
    button, input[type="file"] {
      background: #ff4081;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background: #e60073;
    }
  </style>
</head>
<body>
  <header>
    <h1>TierMaker</h1>
    <p>Upload images and drag them into your custom tiers</p>
  </header>

  <div id="controls">
    <input type="file" id="upload" multiple accept="image/*" />
    <button id="version-switch">Switch to Scoring Mode</button>
  </div>

  <div id="tier-container"></div>

  <div id="unclassified-wrapper">
    <h3>Unclassified</h3>
    <div id="unclassified"></div>
  </div>

  <div id="scoring-panel" class="hidden">
    <h3>Scoring Criteria</h3>
    <div id="criteria-container"></div>
    <button onclick="addCriterion()">Add Criterion</button>
    <h3>Tier Score Thresholds</h3>
    <textarea id="tier-score-settings" rows="7" cols="40">S:90~100
A:80~89
B:70~79
C:60~69
D:50~59
E:40~49
F:0~39</textarea>
    <button onclick="calculateScores()">Calculate Scores and Auto Assign</button>
  </div>

  <script>
    const tiers = ['S', 'A', 'B', 'C', 'D', 'E', 'F'];
    const tierColors = {
      S: '#f87171', A: '#fbbf24', B: '#fde047',
      C: '#4ade80', D: '#60a5fa', E: '#a78bfa', F: '#f472b6'
    };
    const tierContainer = document.getElementById('tier-container');

    tiers.forEach(tier => {
      const div = document.createElement('div');
      div.className = 'tier';
      div.innerHTML = `<div class="tier-label" style="background:${tierColors[tier]}">Tier ${tier}</div><div class="tier-content" data-tier="${tier}"></div>`;
      tierContainer.appendChild(div);
    });

    document.getElementById('upload').addEventListener('change', e => {
      for (const file of e.target.files) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.className = 'image-item';
        img.draggable = true;
        const wrapper = createImageWrapper(img);
        document.getElementById('unclassified').appendChild(wrapper);
      }
    });

    function createImageWrapper(img) {
      const wrapper = document.createElement('div');
      wrapper.className = 'image-wrapper';
      const delBtn = document.createElement('button');
      delBtn.className = 'delete-btn';
      delBtn.textContent = 'Ã—';
      delBtn.onclick = () => wrapper.remove();
      img.addEventListener('click', () => wrapper.classList.toggle('active'));
      addDragEvents(img);
      wrapper.appendChild(img);
      wrapper.appendChild(delBtn);
      return wrapper;
    }

    function addDragEvents(img) {
      img.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', e.target.src);
        e.target.classList.add('dragging');
      });
      img.addEventListener('dragend', e => e.target.classList.remove('dragging'));
    }

    function enableDropAreas() {
      document.querySelectorAll('.tier-content, #unclassified').forEach(area => {
        area.addEventListener('dragover', e => e.preventDefault());
        area.addEventListener('drop', e => {
          e.preventDefault();
          const src = e.dataTransfer.getData('text/plain');
          const dragged = document.querySelector(`img[src='${src}']`);
          if (dragged) area.appendChild(dragged.parentElement);
        });
      });
    }
    enableDropAreas();

    let scoreMode = false;
    document.getElementById('version-switch').addEventListener('click', () => {
      scoreMode = !scoreMode;
      document.getElementById('scoring-panel').classList.toggle('hidden', !scoreMode);
      document.getElementById('version-switch').textContent = scoreMode ? 'Back to Simple Mode' : 'Switch to Scoring Mode';
    });

    function addCriterion() {
      const div = document.createElement('div');
      div.innerHTML = '<input placeholder="Criterion"> <input type="number" placeholder="Max Score">';
      document.getElementById('criteria-container').appendChild(div);
    }

    function calculateScores() {
      const criteria = document.querySelectorAll('#criteria-container div');
      const tierMap = parseTierRanges();
      const images = document.querySelectorAll('.image-item');

      images.forEach(img => {
        let total = 0;
        criteria.forEach(c => {
          const name = c.querySelector('input:nth-child(1)').value;
          const weight = Number(c.querySelector('input:nth-child(2)').value);
          const value = Number(prompt(`${name} score for ${img.src.slice(-10)} (max ${weight}):`));
          total += value / weight * 100;
        });
        total = total / criteria.length;

        for (const [tier, [min, max]] of Object.entries(tierMap)) {
          if (total >= min && total <= max) {
            const wrapper = img.parentElement;
            document.querySelector(`[data-tier="${tier}"]`).appendChild(wrapper);
            break;
          }
        }
      });
    }

    function parseTierRanges() {
      const lines = document.getElementById('tier-score-settings').value.split('\n');
      const map = {};
      lines.forEach(line => {
        const [tier, range] = line.split(':');
        const [min, max] = range.split('~').map(n => Number(n));
        map[tier.trim()] = [min, max];
      });
      return map;
    }
  </script>
</body>
</html>
